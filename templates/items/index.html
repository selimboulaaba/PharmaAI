{% extends "fitness/base.html" %}

{%block title%}Store{%endblock title%}

{%block body%}

<div class="container">
    <div class="w-100">
        <form method="POST" enctype="multipart/form-data" action="{% url 'upload_image' %}">
            {% csrf_token %}
            <div class="d-flex justify-content-between align-items-center my-3 py-3">
                <h1 class="text-dark text-3xl">Store Items</h1>
                <label class="btn bg-indigo-600 text-white hover:bg-indigo-800" style="cursor: pointer;">
                    <div class="h5 my-1 mx-2">Upload Prescription</div>
                    <input type="file" name="image" accept="image/*" onchange="this.form.submit()"
                        class="btn btn-info d-none">
                </label>
            </div>
        </form>
        <hr class="my-3">
        <p class="my-[30px] "><i>
                Please browse through our selection of medicines and add the items you need to your cart.
                You can review detailed information about each medicine to ensure it meets your requirements.
                Once you've finalized your selection, proceed to checkout, and feel free to update your cart or add any
                special instructions if necessary.
            </i></p>
        <hr class="mb-[30px]">
    
        <form method="GET" action="{% url 'store' %}">
            <div class="row mb-2">
                <div class="col">
                    <div class="input-group">
                        <span class="input-group-text" id="basic-addon1">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-search" viewBox="0 0 16 16">
                                <path
                                    d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0" />
                            </svg>
                        </span>
                        <input class="form-control" name="query" type="search" placeholder="Search by Name"
                            aria-label="Search" value="{{ query }}">
                    </div>
                </div>
                <div class="col-auto">
                    <select name="category" class="form-control" id="search-form" aria-label="Filter by Category" onchange="submitForm()">
                        <option value="">All Categories</option>
                        {% for category in categories %}
                            <option value="{{ category.id }}" {% if request.GET.category == category.id|stringformat:"d" %}selected{% endif %}>{{ category.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-auto">
                    <select class="form-control" name="sort" aria-label="Sort by" onchange="submitForm()">
                        <option value="" selected hidden>Sort by</option>
                        <option value="name,asc" {% if request.GET.sort == 'name,asc' %}selected{% endif %}>Name ASC</option>
                        <option value="name,desc" {% if request.GET.sort == 'name,desc' %}selected{% endif %}>Name DESC</option>
                        <option value="price,asc" {% if request.GET.sort == 'price,asc' %}selected{% endif %}>Price ASC</option>
                        <option value="price,desc" {% if request.GET.sort == 'price,desc' %}selected{% endif %}>Price DESC</option>
                    </select>
                </div>
            </div>
        </form>
    
        <div class="row mb-5">
            {% for item in items %}
            <div class="col-sm-6 my-3 transform hover:scale-105 transition-transform duration-200">
                <div class="card rounded-xl">
                    <div class="card-body">
                        <h5 class="card-title text-3xl"><b>
                                {{ item.name }}
                            </b>
                        </h5>
                        <hr>
                        <div>
                            <img src="{{ item.image.url }}" style="width: 100%; ">
                        </div>
                        <p class="text-2xl text-center"><b>Price: </b>{{ item.price }} DT</p>
                        <div class="row justify-content-center align-items-center ">
                            <button type="button" class="mr-1 btn bg-indigo-600 text-white hover:bg-indigo-800 my-2 col-md-5" data-toggle="modal"
                                data-target="#showDetailModal{{ item.id }}">
                                Details
                            </button>
    
                            <button type="button" class="ml-1 btn bg-indigo-600 text-white hover:bg-indigo-800 my-2 col-md-5" data-toggle="modal"
                                data-target="#addToCartModal{{ item.id }}">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
            </div>
    
            <div class="modal fade" id="addToCartModal{{ item.id }}" tabindex="-1" role="dialog"
                aria-labelledby="addToCartTitle{{ item.id }}" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="addToCartTitle{{ item.id }}"><b>Add <span class="text-indigo-600">{{ item.name }}</span> to Cart</b></h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form action="/items/store" method="post">
                                {% csrf_token %}
                                <input type="hidden" name="item" value="{{ item.id }}">
                                <br><label for="quantity"><b>Quantity: </b></label><br>
                                {{ form.quantity }}
                                <br>
                                <button type="submit" class="btn bg-indigo-600 text-white hover:bg-indigo-800 col-md-12">Submit</button>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger col-md-12" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
    
    
            <div class="modal fade" id="showDetailModal{{ item.id }}" tabindex="-1" role="dialog"
                aria-labelledby="exampleModalLongTitle{{ item.id }}" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLongTitle{{ item.id }}"><b>{{ item.name }}</b></h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <img src="{{item.image.url}}" class="img-fluid" alt="">
                            <p class="my-3">{{ item.description }}</p>
                            <br>
                            <table class="table border-white">
                                <tr>
                                    <th>Name</td>
                                    <td>{{ item.name }}</td>
                                </tr>
                                <tr>
                                    <th>Category</td>
                                    <td>{{ item.category }}</td>
                                </tr>
                                <tr>
                                    <th>Price</td>
                                    <td>{{ item.price }} DT</td>
                                </tr>
                            </table>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger col-md-12" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<script>
    function submitForm() {
        document.getElementById('search-form').form.submit();
    }
    </script>

{%endblock body%}